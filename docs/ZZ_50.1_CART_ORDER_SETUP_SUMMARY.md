# TÃ³m Táº¯t Cáº­p Nháº­t Script Seed Cart vÃ  Order

## ğŸ“‹ Tá»•ng Quan

ÄÃ£ phÃ¢n tÃ­ch vÃ  cáº­p nháº­t script seed dá»¯ liá»‡u cho cÃ¡c module Cart vÃ  Order trong há»‡ thá»‘ng E-commerce NestJS, bao gá»“m viá»‡c xá»­ lÃ½ hÃ¬nh áº£nh S3 vÃ  cáº­p nháº­t schema má»›i.

## ğŸ”§ CÃ¡c Thay Äá»•i ChÃ­nh

### 1. Cáº­p Nháº­t Schema Order

- **Váº¥n Ä‘á»**: Model Order Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t vá»›i trÆ°á»ng `paymentId` báº¯t buá»™c
- **Giáº£i phÃ¡p**:
  - ThÃªm import `PaymentStatus` tá»« constants
  - Táº¡o Payment record trÆ°á»›c khi táº¡o Order
  - ThÃªm `paymentId` vÃ o Order creation
  - Cáº­p nháº­t thá»‘ng kÃª Ä‘á»ƒ bao gá»“m sá»‘ lÆ°á»£ng payments

### 2. Xá»­ LÃ½ HÃ¬nh áº¢nh Äa Dáº¡ng

- **Váº¥n Ä‘á»**: Chá»‰ sá»­ dá»¥ng má»™t áº£nh duy nháº¥t cho táº¥t cáº£ sáº£n pháº©m
- **Giáº£i phÃ¡p**:
  - ThÃªm danh sÃ¡ch 4 URL áº£nh S3 khÃ¡c nhau
  - Táº¡o helper functions Ä‘á»ƒ chá»n áº£nh ngáº«u nhiÃªn
  - Má»—i Product cÃ³ 3-4 áº£nh ngáº«u nhiÃªn
  - Má»—i SKU cÃ³ áº£nh riÃªng biá»‡t
  - ProductSKUSnapshot sá»­ dá»¥ng áº£nh fallback

### 3. Cáº£i Thiá»‡n Logic Táº¡o Dá»¯ Liá»‡u

- **TÃ­nh toÃ¡n tá»•ng tiá»n**: TÃ­nh tá»•ng giÃ¡ trá»‹ order dá»±a trÃªn SKU vÃ  quantity
- **Payment Status**: Random status cho payment (PENDING, SUCCESS, FAILED)
- **Order Status**: Random status cho order (PENDING_PAYMENT, PENDING_PICKUP, DELIVERED)

## ğŸ“ Files ÄÃ£ Cáº­p Nháº­t

### 1. `initialScript/add-cart-order-data.ts`

```typescript
// ThÃªm import PaymentStatus
import { PaymentStatus } from 'src/shared/constants/payment.constant'

// ThÃªm danh sÃ¡ch áº£nh Ä‘a dáº¡ng
const SAMPLE_IMAGE_URLS = [
  'https://ecommerce-super-nestjs.s3.ap-southeast-1.amazonaws.com/d79f483f-61d7-42dc-83ef-0e5b9037a275.jpg',
  'https://ecommerce-super-nestjs.s3.ap-southeast-1.amazonaws.com/a1affb40-aafc-4de1-a808-6efe7a41e85a.png',
  'https://ecommerce-super-nestjs.s3.ap-southeast-1.amazonaws.com/images/19ac0360-d1cd-496b-9cb9-f2aea4e440df.jpg',
  'https://ecommerce-super-nestjs.s3.ap-southeast-1.amazonaws.com/images/a1bf30cd-647f-4699-9765-8053f2e75a72.jpg',
]

// Helper functions
const pickRandom = <T>(arr: T[]): T => arr[Math.floor(Math.random() * arr.length)]
const pickImagesForProduct = (): string[] => {
  const shuffled = [...SAMPLE_IMAGE_URLS].sort(() => 0.5 - Math.random())
  const count = Math.min(4, Math.max(3, Math.floor(Math.random() * 4)))
  return shuffled.slice(0, count)
}

// Logic táº¡o Payment trÆ°á»›c Order
const payment = await prisma.payment.create({
  data: {
    status: [PaymentStatus.PENDING, PaymentStatus.SUCCESS, PaymentStatus.FAILED][Math.floor(Math.random() * 3)],
  },
})

const order = await prisma.order.create({
  data: {
    // ... other fields
    paymentId: payment.id,
  },
})
```

### 2. `docs/postman/NestJS_Ecommerce_API.postman_collection.json`

- ÄÃ£ cáº­p nháº­t collection Postman vá»›i cÃ¡c API endpoints cho Cart vÃ  Order
- Bao gá»“m cÃ¡c request máº«u vá»›i headers vÃ  body phÃ¹ há»£p

## ğŸš€ CÃ¡ch Sá»­ Dá»¥ng

### 1. Cháº¡y Script Seed

```bash
# Cháº¡y script táº¡o dá»¯ liá»‡u máº«u
npx ts-node initialScript/add-cart-order-data.ts
```

### 2. Test API vá»›i Postman

- Import file `docs/postman/NestJS_Ecommerce_API.postman_collection.json`
- Sá»­ dá»¥ng cÃ¡c request trong thÆ° má»¥c "Cart" vÃ  "Orders"

## ğŸ“Š Dá»¯ Liá»‡u ÄÆ°á»£c Táº¡o

### Users

- 3 khÃ¡ch hÃ ng (customers)
- 2 sellers (shop owners)
- Má»—i user cÃ³ avatar tá»« S3

### Products & SKUs

- 5 sáº£n pháº©m vá»›i variants khÃ¡c nhau
- Má»—i product cÃ³ 3-4 áº£nh ngáº«u nhiÃªn
- SKUs vá»›i giÃ¡ vÃ  stock ngáº«u nhiÃªn
- Má»—i SKU cÃ³ áº£nh riÃªng biá»‡t

### Cart & Orders

- Cart items cho má»—i khÃ¡ch hÃ ng
- Orders vá»›i payment records
- ProductSKUSnapshots cho order history

### Thá»‘ng KÃª

- Users: ~5 records
- Brands: 5 records
- Categories: 4 records
- Products: 5 records
- SKUs: ~20-30 records (tÃ¹y variants)
- Cart Items: ~9-15 records
- Orders: ~3-6 records
- Payments: ~3-6 records
- Product Snapshots: ~10-20 records

## ğŸ”— URLs HÃ¬nh áº¢nh S3

1. [áº¢nh 1](https://ecommerce-super-nestjs.s3.ap-southeast-1.amazonaws.com/d79f483f-61d7-42dc-83ef-0e5b9037a275.jpg)
2. [áº¢nh 2](https://ecommerce-super-nestjs.s3.ap-southeast-1.amazonaws.com/a1affb40-aafc-4de1-a808-6efe7a41e85a.png)
3. [áº¢nh 3](https://ecommerce-super-nestjs.s3.ap-southeast-1.amazonaws.com/images/19ac0360-d1cd-496b-9cb9-f2aea4e440df.jpg)
4. [áº¢nh 4](https://ecommerce-super-nestjs.s3.ap-southeast-1.amazonaws.com/images/a1bf30cd-647f-4699-9765-8053f2e75a72.jpg)

## âœ… Kiá»ƒm Tra Cháº¥t LÆ°á»£ng

- âœ… ESLint: KhÃ´ng cÃ³ lá»—i
- âœ… TypeScript: ÄÃ£ sá»­a lá»—i Map iteration
- âœ… Schema: TÆ°Æ¡ng thÃ­ch vá»›i Prisma schema má»›i
- âœ… Logic: Táº¡o dá»¯ liá»‡u theo Ä‘Ãºng thá»© tá»± dependencies

## ğŸ¯ Káº¿t Quáº£

Script Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t thÃ nh cÃ´ng Ä‘á»ƒ:

1. TÆ°Æ¡ng thÃ­ch vá»›i schema Order má»›i (cÃ³ paymentId)
2. Sá»­ dá»¥ng Ä‘a dáº¡ng hÃ¬nh áº£nh S3 cho sáº£n pháº©m
3. Táº¡o dá»¯ liá»‡u máº«u phong phÃº cho testing
4. Cung cáº¥p Postman collection Ä‘á»ƒ test API

Táº¥t cáº£ Ä‘Ã£ sáºµn sÃ ng Ä‘á»ƒ cháº¡y vÃ  test cÃ¡c module Cart vÃ  Order!
